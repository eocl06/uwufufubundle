<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wish It Were Real - Turnuva</title>
    <link crossorigin href="https://fonts.gstatic.com/" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?display=swap&family=Lexend:wght@400;500;700;900&family=Manrope:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABFSURBVDhPYxgFo2AUjIJRMDIgBaMWAMGWg40CGGARKIcFFhAFqiBELKwL0RAUEpZSYYAAKUmZASwYGLAESJgRKMIAAGVyBqwSAFXRAAAAAElFTkSuQmCC" type="image/x-icon"/>
    <style>
        body {
            min-height: max(884px, 100dvh);
            font-family: 'Lexend', "Manrope", "Noto Sans", sans-serif;
            overscroll-behavior-y: contain;
        }
        .hidden-screen { display: none !important; }

        /* Giriş Ekranı Stilleri */
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .floating-headline { animation: float 6s ease-in-out infinite; opacity: 0.1; }
        @keyframes backgroundMorph { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .background-animate { background: linear-gradient(270deg, #faf8f6, #e0e0e0, #faf8f6); background-size: 600% 600%; animation: backgroundMorph 15s ease infinite; }
        .start-button { background: linear-gradient(90deg, #76A9FA, #FF6F61); transition: transform 0.2s ease-out, box-shadow 0.2s ease-out; }
        .start-button:hover, .start-button:focus { transform: scale(1.05); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15); }

        /* Oyun Ekranı Stilleri */
        .card { transition: transform 0.3s ease-out, opacity 0.3s ease-out; cursor: pointer; }
        .card.selected { transform: scale(1.05); z-index: 10; }
        .card.not-selected { opacity: 0; transform: translateX(100px); }
        .confetti-burst { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 200px; height: 200px; background-image: radial-gradient(circle, rgba(255, 215, 0, 0.5) 0%, rgba(255, 215, 0, 0) 70%); border-radius: 50%; opacity: 0; animation: burst 0.7s ease-out forwards; z-index: 5; }
        @keyframes burst { 0% { opacity: 0.5; transform: translate(-50%, -50%) scale(0.5); } 100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); } }
        .progress-bar-spark { position: absolute; right: -5px; top: -3px; width: 10px; height: 10px; background-color: #FFD700; border-radius: 50%; box-shadow: 0 0 8px 2px #FFD700; opacity: 0; animation: pulse-spark 0.5s ease-in-out; }
        @keyframes pulse-spark { 0%, 100% { opacity: 0; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.2); } }

        /* Turnuva Geçiş Ekranı Stilleri (HTML #3) */
        .tournament-card-glow { box-shadow: 0 0 15px 5px rgba(66, 138, 239, 0.5), 0 0 30px 10px rgba(66, 138, 239, 0.3); animation: pulse-glow-qf 2s infinite; }
        .tournament-final-card-glow { background: linear-gradient(135deg, #fff1c0 0%, #ffe082 100%); box-shadow: 0 0 20px 8px rgba(255, 215, 0, 0.6), 0 0 40px 15px rgba(255, 215, 0, 0.4); }
        @keyframes pulse-glow-qf { 0% { box-shadow: 0 0 15px 5px rgba(66, 138, 239, 0.5), 0 0 30px 10px rgba(66, 138, 239, 0.3); } 50% { box-shadow: 0 0 25px 10px rgba(66, 138, 239, 0.7), 0 0 40px 15px rgba(66, 138, 239, 0.5); } 100% { box-shadow: 0 0 15px 5px rgba(66, 138, 239, 0.5), 0 0 30px 10px rgba(66, 138, 239, 0.3); } }
        
        /* Sonuç Ekranı Stilleri */
        .bg-hero-gradient { background-image: linear-gradient(to bottom, rgba(0,0,0,0.0), rgba(0,0,0,0.6)); }
        .gold-crown { color: #FFD700; }
        .material-icons, .material-icons-outlined { vertical-align: middle; }
    </style>
</head>
<body class="bg-[#FAF8F6]">

    <div id="startScreen" class="relative flex size-full min-h-screen flex-col justify-between items-center group/design-root overflow-hidden p-6 background-animate">
        <div class="absolute inset-0 overflow-hidden z-0">
            <div class="absolute top-1/4 left-1/4 text-lg font-light text-gray-400 floating-headline" style="animation-delay: 0s;">Herkes için evrensel temel gelir</div>
            <div class="absolute top-1/2 right-1/4 text-lg font-light text-gray-400 floating-headline" style="animation-delay: 2s;">Haftalık çalışma süresi 3 gün</div>
        </div>
        <div class="flex flex-col items-center justify-center flex-grow z-10 text-center">
            <h1 class="text-[#1a1a1a] tracking-tight text-[48px] sm:text-[64px] font-bold leading-tight pb-4 pt-12">Keşke Gerçek Olsa</h1>
            <p class="text-[#333333] text-xl sm:text-2xl font-normal leading-relaxed pb-8 max-w-md">Geleceği seçebilseydin, hangisini seçerdin?</p>
        </div>
        <div class="w-full flex justify-center pb-12 z-10">
            <button id="startGameButton" class="start-button flex min-w-[120px] max-w-[480px] w-full sm:w-auto cursor-pointer items-center justify-center overflow-hidden rounded-full h-16 px-8 text-white text-xl font-bold shadow-lg">
                <span class="truncate">Başla</span>
            </button>
        </div>
    </div>

    <div id="gameScreen" class="hidden-screen relative flex size-full min-h-screen flex-col justify-between group/design-root overflow-hidden bg-slate-50">
        <div class="flex flex-col flex-grow">
            <div class="sticky top-0 z-20 bg-slate-50 p-4 shadow-sm">
                <div class="flex justify-between items-center mb-1">
                    <p id="progressTextElement" class="text-[#0d131b] text-sm font-medium leading-normal">Başlangıç Turu: Maç 1 / 16</p>
                </div>
                <div class="h-1.5 rounded-full bg-[#cfd9e7] relative overflow-hidden">
                    <div id="progressBarFill" class="h-full rounded-full bg-[#428aef]" style="width: 0%;"></div>
                </div>
            </div>
            <div class="flex-grow flex flex-col items-center justify-center p-4 space-y-6 @md:space-y-0 @md:flex-row @md:space-x-6 @md:items-center @md:justify-center">
                <div class="card w-full max-w-md @md:max-w-sm bg-white rounded-xl shadow-xl overflow-hidden relative">
                    <div class="confetti-burst hidden"></div> 
                    <div class="card-image w-full h-48 bg-center bg-no-repeat bg-cover" style='background-image: url("https://picsum.photos/seed/game_card1_placeholder/600/400");'></div>
                    <div class="p-5">
                        <h2 class="card-title text-[#0d131b] text-xl font-bold leading-tight mb-2">Dilek A</h2>
                        <p class="card-description text-[#4c6c9a] text-sm font-normal leading-relaxed">Dilek A açıklaması.</p>
                    </div>
                </div>
                <div class="flex items-center justify-center my-0 @md:my-0 @md:mx-2">
                    <span class="bg-[#428aef] text-white text-xs font-bold px-3 py-1.5 rounded-full shadow-md transform rotate-[-15deg] @md:rotate-0">VS</span>
                </div>
                <div class="card w-full max-w-md @md:max-w-sm bg-white rounded-xl shadow-xl overflow-hidden relative">
                    <div class="confetti-burst hidden"></div> 
                    <div class="card-image w-full h-48 bg-center bg-no-repeat bg-cover" style='background-image: url("https://picsum.photos/seed/game_card2_placeholder/600/400");'></div>
                    <div class="p-5">
                        <h2 class="card-title text-[#0d131b] text-xl font-bold leading-tight mb-2">Dilek B</h2>
                        <p class="card-description text-[#4c6c9a] text-sm font-normal leading-relaxed">Dilek B açıklaması.</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="h-5 bg-slate-50"></div>
    </div>
    
    <div id="tournamentTransitionScreen" class="hidden-screen relative flex size-full min-h-screen flex-col bg-slate-100 justify-between group/design-root overflow-x-hidden">
        <div>
            <header class="bg-slate-100 sticky top-0 z-10">
                <div class="flex items-center p-4 pb-2 justify-between">
                    <div class="w-12"></div> 
                    <h1 id="tournamentTransitionTitle" class="text-xl font-bold text-slate-800">Finalistler!</h1> <div class="flex w-12 items-center justify-end">
                        <button id="closeTournamentTransitionButton" aria-label="Kapat" class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 w-10 bg-slate-200 hover:bg-slate-300 text-slate-700 transition-colors">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                </div>
                <h2 id="tournamentTransitionSubtitle" class="text-slate-600 text-sm font-medium px-6 text-center pb-3 pt-1">Şampiyonluğa bir adım kaldı!</h2>
            </header>
            <main id="tournamentTransitionCardContainer" class="p-4 space-y-6">
                <div class="finalist-card bg-white rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl tournament-final-card-glow @container">
                    <div class="card-image w-full bg-center bg-no-repeat aspect-[16/10] bg-cover" style='background-image: url("https://picsum.photos/seed/finalist1_placeholder/600/400");'></div>
                    <div class="p-4 @xl:px-5">
                        <h3 class="card-title text-yellow-700 text-xl font-bold leading-tight">Finalist 1 Başlığı</h3>
                        <p class="card-description text-yellow-600 text-sm font-normal mt-1">Finalist 1 açıklaması.</p>
                        <p class="card-votes text-yellow-500 text-xs font-medium mt-2">Çok oy aldı!</p>
                    </div>
                </div>
                <div class="finalist-card bg-white rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl tournament-card-glow @container">
                    <div class="card-image w-full bg-center bg-no-repeat aspect-[16/10] bg-cover" style='background-image: url("https://picsum.photos/seed/finalist2_placeholder/600/400");'></div>
                    <div class="p-4 @xl:px-5">
                        <h3 class="card-title text-slate-800 text-lg font-bold leading-tight">Finalist 2 Başlığı</h3>
                        <p class="card-description text-slate-500 text-sm font-normal mt-1">Finalist 2 açıklaması.</p>
                        <p class="card-votes text-slate-400 text-xs font-medium mt-2">Bu da çok oy aldı!</p>
                    </div>
                </div>
                 <div class="finalist-card bg-white rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl @container">
                    <div class="card-image w-full bg-center bg-no-repeat aspect-[16/10] bg-cover" style='background-image: url("https://picsum.photos/seed/popular_placeholder/600/400");'></div>
                    <div class="p-4 @xl:px-5">
                        <h3 class="card-title text-slate-800 text-lg font-bold leading-tight">Popüler Diğer Dilek</h3>
                        <p class="card-description text-slate-500 text-sm font-normal mt-1">Bu dilek de çok sevilmişti.</p>
                         <p class="card-votes text-slate-400 text-xs font-medium mt-2">Yüksek oy!</p>
                    </div>
                </div>
            </main>
        </div>
        <div id="loadingScreenTournamentTransition" class="fixed inset-0 bg-slate-900 bg-opacity-80 hidden flex-col items-center justify-center z-50">
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-400 mb-6"></div>
            <p class="text-slate-100 text-lg font-semibold text-center px-8">Final maçı hazırlanıyor...</p>
        </div>
        <footer class="sticky bottom-0 bg-slate-100 border-t border-slate-200 pb-safe">
            <div class="flex gap-3 px-4 py-3 justify-around">
                <button id="proceedToFinalMatchButton" class="flex-1 max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-12 px-6 bg-[#428aef] text-slate-50 text-base font-bold leading-normal tracking-[0.015em] hover:bg-blue-600 transition-colors">
                    <span class="truncate">Final Maçına Geç</span>
                </button>
                </div>
        </footer>
    </div>

    <div id="resultsScreen" class="hidden-screen relative flex size-full min-h-screen flex-col justify-between group/design-root overflow-x-hidden bg-slate-50">
        <div>
            <header class="sticky top-0 z-10 bg-slate-50/80 backdrop-blur-sm">
                <div class="flex items-center p-4 pb-3">
                    <button id="closeResultsButton" aria-label="Kapat" class="text-slate-700 flex size-10 shrink-0 items-center justify-center rounded-full hover:bg-slate-200 transition-colors">
                        <span class="material-icons-outlined">close</span>
                    </button>
                    <h1 class="text-slate-900 text-xl font-bold leading-tight flex-1 text-center pr-10">Turnuva Sonuçları</h1>
                </div>
            </header>
            <main class="pb-24">
                <h2 class="text-slate-800 text-2xl font-semibold leading-tight px-6 text-center pb-6 pt-5">Ve şampiyon dilek...</h2>
                <div id="resultsCardContainer" class="px-4 space-y-4">
                    <div id="championCardDisplay" class="bg-white shadow-xl rounded-2xl overflow-hidden border-2 border-yellow-400 transform scale-105">
                        <div class="relative">
                            <img alt="Şampiyon dilek" id="championImage" class="w-full h-48 object-cover" src="https://picsum.photos/seed/champion_placeholder/600/400"/>
                            <div class="absolute inset-0 bg-hero-gradient"></div>
                            <div class="absolute top-2 right-2 gold-crown">
                                <span class="material-icons" style="font-size: 36px;">emoji_events</span>
                            </div>
                            <div class="absolute bottom-0 left-0 p-4">
                                <p id="championTitle" class="text-white text-3xl font-bold leading-tight">Şampiyon Dilek Başlığı!</p>
                                <div class="flex items-center mt-2">
                                    <span class="material-icons text-red-400 mr-1" style="font-size: 20px;">favorite</span>
                                    <p id="championInfo" class="text-white text-base font-medium">Tüm rakiplerini geride bıraktı!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
            </main>
        </div>
        <nav class="fixed bottom-0 left-0 right-0 bg-slate-50/90 backdrop-blur-md border-t border-slate-200">
            <div class="flex justify-around items-center px-2 pt-2 pb-3 safe-area-inset-bottom">
                <a id="resultsPlayAgainButton" href="#" class="flex flex-col items-center justify-end gap-0.5 text-slate-500 hover:text-blue-600 transition-colors w-1/3 py-1">
                    <span class="material-icons-outlined">casino</span>
                    <p class="text-xs font-medium tracking-tight">Tekrar Oyna</p>
                </a>
                <a href="#" class="flex flex-col items-center justify-end gap-0.5 text-blue-600 font-semibold w-1/3 py-1 bg-blue-100 rounded-lg">
                    <span class="material-icons">emoji_events</span>
                    <p class="text-xs font-medium tracking-tight">Sonuçlar</p>
                </a>
                <a id="resultsToFinishButton" href="#" class="flex flex-col items-center justify-end gap-0.5 text-slate-500 hover:text-blue-600 transition-colors w-1/3 py-1">
                    <span class="material-icons-outlined">celebration</span>
                    <p class="text-xs font-medium tracking-tight">Bitir</p>
                </a>
            </div>
        </nav>
    </div>

    <div id="finishScreen" class="hidden-screen relative flex size-full min-h-screen flex-col bg-slate-50 group/design-root overflow-x-hidden">
        <div class="flex-grow">
            <header class="flex items-center bg-slate-50 p-4 pb-2 justify-end">
                <button id="closeFinishButton" aria-label="Kapat" class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 w-10 bg-slate-200/70 hover:bg-slate-300/70 text-[#0d131b] transition-colors duration-200">
                     <span class="material-icons">close</span>
                </button>
            </header>
            <div class="px-6 pt-6 pb-4 text-center">
                <svg class="w-16 h-16 mx-auto text-yellow-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg>
                <h1 class="text-[#0d131b] text-3xl font-bold leading-tight pb-2">Turnuva Tamamlandı!</h1>
                <p id="winningWishTextFinish" class="text-slate-600 text-lg font-normal leading-relaxed">
                    Şampiyon dilek: [Şampiyon Dilek Başlığı]! Bu harika geleceği arkadaşlarınla paylaş!
                </p>
            </div>
            <div class="flex flex-col gap-3 px-6 py-4">
                <button id="shareChampionButton" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-14 px-6 flex-1 bg-[#428aef] text-slate-50 text-lg font-bold shadow-md hover:shadow-lg">
                    <span class="truncate">Şampiyonu Paylaş</span>
                </button>
                <button id="finishPlayAgainButton" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-14 px-6 flex-1 bg-slate-200 text-[#0d131b] text-lg font-bold hover:bg-slate-300">
                    <span class="truncate">Yeni Turnuva Başlat</span>
                </button>
            </div>
             <div class="px-6 pt-8 pb-4">
                <h2 class="text-[#0d131b] text-2xl font-bold leading-tight">Diğer Popüler Hayaller...</h2>
            </div>
            <div class="flex overflow-x-auto [-ms-scrollbar-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden pl-6 pr-2 pb-6">
                <div id="moreDreamsContainer" class="flex items-stretch gap-4">
                    </div>
            </div>
        </div>
        <nav class="sticky bottom-0 left-0 right-0 bg-slate-50/90 backdrop-blur-md border-t border-slate-200 shadow-t-lg">
            <div class="flex justify-around items-center px-4 pt-3 pb-4">
                <a id="finishHomeButton" href="#" class="flex flex-col items-center justify-center gap-1 text-[#0d131b] hover:text-[#428aef] transition-colors">
                    <span class="material-icons">home</span> <span class="text-xs font-medium">Ana Sayfa</span>
                </a>
                 <a id="finishToResultsButton" href="#" class="flex flex-col items-center justify-center gap-1 text-slate-500 hover:text-[#428aef] transition-colors">
                    <span class="material-icons-outlined">emoji_events</span> <span class="text-xs font-medium">Sonuçlar</span>
                </a>
                <a href="#" class="flex flex-col items-center justify-center gap-1 text-slate-500 hover:text-[#428aef] transition-colors">
                    <div class="p-2 bg-[#428aef] rounded-full text-white shadow-md -translate-y-3">
                        <span class="material-icons">add</span>
                    </div>
                    <span class="text-xs font-medium -translate-y-3">Oluştur</span>
                </a>
                 <a href="#" class="flex flex-col items-center justify-center gap-1 text-slate-500 hover:text-[#428aef] transition-colors">
                    <span class="material-icons-outlined">people</span> <span class="text-xs font-medium">Topluluk</span>
                </a>
                <a href="#" class="flex flex-col items-center justify-center gap-1 text-slate-500 hover:text-[#428aef] transition-colors">
                    <span class="material-icons-outlined">person_outline</span> <span class="text-xs font-medium">Profil</span>
                </a>
            </div>
        </nav>
    </div>

<script>
    // ---------- DOM Elementleri ----------
    const screens = {
        start: document.getElementById('startScreen'),
        game: document.getElementById('gameScreen'),
        tournamentTransition: document.getElementById('tournamentTransitionScreen'),
        results: document.getElementById('resultsScreen'),
        finish: document.getElementById('finishScreen')
    };

    const startGameButton = document.getElementById('startGameButton');
    const gameScreenCards = document.querySelectorAll('#gameScreen .card');
    const progressBarFill = document.getElementById('progressBarFill');
    const progressTextElement = document.getElementById('progressTextElement');

    const tournamentTransitionTitle = document.getElementById('tournamentTransitionTitle');
    const tournamentTransitionSubtitle = document.getElementById('tournamentTransitionSubtitle');
    const tournamentTransitionCardContainer = document.getElementById('tournamentTransitionCardContainer');
    const closeTournamentTransitionButton = document.getElementById('closeTournamentTransitionButton');
    const proceedToFinalMatchButton = document.getElementById('proceedToFinalMatchButton');
    const loadingScreenTournamentTransition = document.getElementById('loadingScreenTournamentTransition');
    
    const resultsCardContainer = document.getElementById('resultsCardContainer');
    const championCardDisplay = document.getElementById('championCardDisplay');
    const championImage = document.getElementById('championImage');
    const championTitle = document.getElementById('championTitle');
    const championInfo = document.getElementById('championInfo');
    const closeResultsButton = document.getElementById('closeResultsButton');
    const resultsPlayAgainButton = document.getElementById('resultsPlayAgainButton');
    const resultsToFinishButton = document.getElementById('resultsToFinishButton');

    const winningWishTextFinishElement = document.getElementById('winningWishTextFinish');
    const shareChampionButton = document.getElementById('shareChampionButton');
    const finishPlayAgainButton = document.getElementById('finishPlayAgainButton');
    const closeFinishButton = document.getElementById('closeFinishButton');
    const finishHomeButton = document.getElementById('finishHomeButton');
    const finishToResultsButton = document.getElementById('finishToResultsButton');
    const moreDreamsContainer = document.getElementById('moreDreamsContainer');

    // ---------- Oyun Verileri ve Durumu ----------
    const STAGES = {
        SEEDING: 'Seeding Round', // 16 maç -> 16 kazanan
        ROUND_OF_16: 'Son 16 Turu', // 8 maç -> 8 kazanan
        QUARTERFINALS: 'Çeyrek Final', // 4 maç -> 4 kazanan
        SEMIFINALS: 'Yarı Final', // 2 maç -> 2 kazanan
        TRANSITION_TO_FINAL: 'TransitionToFinal', // Yarı final sonrası geçiş ekranı
        FINAL: 'Final Maçı', // 1 maç -> 1 şampiyon
        RESULTS: 'Results',
        FINISHED: 'Finished'
    };

    let currentStage = STAGES.SEEDING;
    let currentMatchInStage = 0;
    let wishesForCurrentStage = []; // O anki turda yarışan dilekler
    let nextStageWishes = []; // O anki turun kazananları, bir sonraki turun yarışanları olacak
    let voteCounts = {}; // { wishId: count }
    let allTimeWinners = []; // Tüm kazananları ve oy sayılarını tutabiliriz
    let champion = null;

    const wishes = [ /* Bir önceki yanıttaki wishes array'ini buraya kopyalayın */
        { id:1, title: "Evrensel Temel Gelir", description: "Tüm vatandaşlar için düzenli ve koşulsuz bir gelir sağlanır.", imageSeed: "income_v3" },
        { id:2, title: "Kansere Kesin Çözüm", description: "Tıpta devrim niteliğinde bir buluşla kanser tamamen tedavi edilebilir hale gelir.", imageSeed: "cancer_cure_v3" },
        { id:3, title: "Küresel Ağaçlandırma Seferberliği", description: "Dünya genelinde milyarlarca ağaç dikilerek iklim değişikliğiyle mücadele edilir.", imageSeed: "reforest_v3" },
        { id:4, title: "3 Günlük Çalışma Haftası", description: "Verimlilik artarken, insanlar daha dengeli bir yaşam sürer.", imageSeed: "work_3day_v3" },
        { id:5, title: "Tamamen Temiz Enerji", description: "Dünya enerji ihtiyacının tamamı yenilenebilir kaynaklardan karşılanır.", imageSeed: "clean_energy_v3" },
        { id:6, title: "Kalıcı Dünya Barışı", description: "Tüm uluslar arasında anlaşmazlıklar son bulur, savaşlar tarihe karışır.", imageSeed: "world_peace_v3" },
        { id:7, title: "Mars Kolonisi Kurulur", description: "İnsanlık, Mars'ta kendi kendine yetebilen bir koloni kurarak gezegenler arası bir tür olur.", imageSeed: "mars_colony_v3" },
        { id:8, title: "Yapay Zeka ile Küresel Sorunlara Çözüm", description: "Yapay zeka, iklim değişikliği, hastalıklar gibi büyük sorunların çözümünde kilit rol oynar.", imageSeed: "ai_solve_v3" },
        { id:9, title: "Parazitsiz ve Erişilebilir Eğitim", description: "Herkes için nitelikli eğitim fırsatları eşit ve ücretsiz hale gelir.", imageSeed: "free_edu_v3" },
        { id:10, title: "Okyanuslar Plastikten Arındırılır", description: "Gelişmiş teknolojilerle okyanuslardaki tüm plastik atıklar temizlenir.", imageSeed: "clean_oceans_v3" },
        { id:11, title: "Yıldızlararası Seyahat Mümkün Olur", description: "İnsanlık, ışık hızına yakın hızlarda seyahat edebilen uzay gemileri geliştirir.", imageSeed: "interstellar_v3" },
        { id:12, title: "Kişiye Özel Tıp ile Uzun Yaşam", description: "Genetik yapıya uygun tedavi yöntemleriyle insan ömrü sağlıklı bir şekilde uzar.", imageSeed: "long_life_v3" },
        { id:13, title: "Küresel Gıda Güvenliği", description: "Sürdürülebilir tarım ve adil dağıtımla dünyada açlık sona erer.", imageSeed: "food_forall_v3" },
        { id:14, title: "Ruh Sağlığı Stigması Kalkar", description: "Ruh sağlığı hizmetleri yaygınlaşır ve toplumsal kabul görür.", imageSeed: "mental_health_v3" },
        { id:15, title: "Nesli Tükenen Hayvanlar Geri Döner", description: "Klonlama ve genetik mühendislik ile bazı nesli tükenmiş hayvanlar yeniden hayata döndürülür.", imageSeed: "deextinct_v3" },
        { id:16, title: "Anında Madde Işınlama (Eşya)", description: "Eşyalar için anında ışınlama teknolojisi, lojistik ve ticarette devrim yaratır.", imageSeed: "teleport_goods_v3" },
        { id:17, title: "Geniş Doğal Yaşam Koruma Alanları", description: "Dünya yüzeyinin büyük bir kısmı koruma altına alınarak biyoçeşitlilik garanti edilir.", imageSeed: "nature_reserve_v3" },
        { id:18, title: "Füzyon Enerjisi Santralleri", description: "Temiz ve neredeyse sınırsız enerji kaynağı olan füzyon reaktörleri yaygınlaşır.", imageSeed: "fusion_power_v3" },
        { id:19, title: "Tüm Öğrenci Borçları Silinir", description: "Genç nesiller, eğitim borcu yükü olmadan hayata başlar.", imageSeed: "debt_free_edu_v3" },
        { id:20, title: "Küresel Hızlı Tren Ağı", description: "Kıtalararası seyahat, çevre dostu ve süper hızlı trenlerle yapılır.", imageSeed: "fast_train_v3" },
        { id:21, title: "Uzaylılarla İlk Temas (Barışçıl)", description: "İnsanlık, dost canlısı bir uzaylı medeniyetiyle resmi temas kurar.", imageSeed: "alien_contact_v3" },
        { id:22, title: "Atmosfer Temizleme Teknolojisi", description: "Hava kirliliği ve sera gazları atmosferden etkin bir şekilde temizlenir.", imageSeed: "clean_air_v3" },
        { id:23, title: "Herkes İçin Sanal Gerçeklik Dünyaları", description: "İnsanlar, ultra gerçekçi sanal dünyalarda eğitim alabilir, çalışabilir ve eğlenebilir.", imageSeed: "metaverse_v3" },
        { id:24, title: "Okyanus Altı Şehirler Kurulur", description: "Deniz seviyesinin yükselmesine karşı okyanusların altında yaşam alanları inşa edilir.", imageSeed: "underwater_city_v3" }
    ];
    let availableWishesForSeeding = [];


    // ---------- Yardımcı Fonksiyonlar ----------
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function showScreen(screenId) {
        Object.values(screens).forEach(screen => screen.classList.add('hidden-screen'));
        if (screens[screenId]) {
            screens[screenId].classList.remove('hidden-screen');
            const bodyClassList = document.body.classList;
            bodyClassList.remove('background-animate', 'bg-[#FAF8F6]', 'bg-slate-50', 'bg-slate-100'); // Önce hepsini kaldır
            if (screenId === 'start') bodyClassList.add('background-animate', 'bg-[#FAF8F6]');
            else if (screenId === 'tournamentTransition') bodyClassList.add('bg-slate-100');
            else bodyClassList.add('bg-slate-50');
        } else {
            console.error("Ekran bulunamadı:", screenId);
        }
    }
    
    // ---------- Oyun Mantığı Fonksiyonları ----------
    function resetGame() {
        currentStage = STAGES.SEEDING;
        currentMatchInStage = 0;
        wishesForCurrentStage = [];
        nextStageWishes = [];
        voteCounts = {};
        allTimeWinners = [];
        champion = null;
        
        availableWishesForSeeding = [...wishes];
        shuffleArray(availableWishesForSeeding);
        // Başlangıç turu için 32 dilek al (16 maç x 2 dilek/maç)
        wishesForCurrentStage = availableWishesForSeeding.slice(0, 32); 
        if(wishesForCurrentStage.length < 32) {
            // Yeterli dilek yoksa, olanlarla devam et veya hata ver. Şimdilik olanlarla.
            console.warn("Başlangıç turu için yeterli (32) dilek yok. Mevcut:", wishesForCurrentStage.length);
        }

        updateProgressBar();
        loadNextMatchUI();
    }

    function getMatchPair() {
        if (wishesForCurrentStage.length < (currentMatchInStage * 2) + 2) {
            console.error("Mevcut tur için yeterli dilek kalmadı!", currentStage, currentMatchInStage, wishesForCurrentStage.length);
            return [wishes[0], wishes[1]]; // Hata durumunda varsayılan
        }
        const wish1 = wishesForCurrentStage[currentMatchInStage * 2];
        const wish2 = wishesForCurrentStage[(currentMatchInStage * 2) + 1];
        return [wish1, wish2];
    }
    
    function loadNextMatchUI() {
        const [wish1, wish2] = getMatchPair();
        if (!wish1 || !wish2) {
            console.error("Maç için dilekler yüklenemedi. Stage:", currentStage, "Match:", currentMatchInStage);
            // Hata durumunda bir sonraki aşamaya geçmeyi dene veya oyunu bitir
            advanceToNextStage();
            return;
        }

        gameScreenCards[0].querySelector('.card-title').textContent = wish1.title;
        gameScreenCards[0].querySelector('.card-description').textContent = wish1.description;
        gameScreenCards[0].querySelector('.card-image').style.backgroundImage = `url("https://picsum.photos/seed/${wish1.imageSeed}/600/400")`;
        gameScreenCards[0].dataset.wishId = wish1.id;

        gameScreenCards[1].querySelector('.card-title').textContent = wish2.title;
        gameScreenCards[1].querySelector('.card-description').textContent = wish2.description;
        gameScreenCards[1].querySelector('.card-image').style.backgroundImage = `url("https://picsum.photos/seed/${wish2.imageSeed}/600/400")`;
        gameScreenCards[1].dataset.wishId = wish2.id;

        gameScreenCards.forEach(card => {
            card.classList.remove('selected', 'not-selected');
            card.style.pointerEvents = 'auto';
            const confetti = card.querySelector('.confetti-burst');
            if (confetti) confetti.classList.add('hidden');
        });
    }

    function updateProgressBar() {
        let totalMatchesInStage = 0;
        if (currentStage === STAGES.SEEDING) totalMatchesInStage = 16; // 32 dilek / 2
        else totalMatchesInStage = wishesForCurrentStage.length / 2;

        const progress = totalMatchesInStage > 0 ? ((currentMatchInStage) / totalMatchesInStage) * 100 : 0;
        progressBarFill.style.width = `${progress}%`;
        progressTextElement.textContent = `${currentStage}: Maç ${currentMatchInStage + 1} / ${totalMatchesInStage}`;
        if(currentStage === STAGES.FINAL) progressTextElement.textContent = "FİNAL MAÇI!";


        if (currentMatchInStage >= 0 && wishesForCurrentStage.length > 0) { // Spark efekti
            const spark = document.createElement('div');
            spark.className = 'progress-bar-spark';
            spark.style.left = `calc(${progress}% - 5px)`; 
            progressBarFill.appendChild(spark);
            setTimeout(() => spark.remove(), 500);
        }
    }

    function handleCardSelection(selectedCardNode) {
        gameScreenCards.forEach(c => c.style.pointerEvents = 'none');
        selectedCardNode.classList.add('selected');
        
        const chosenWishId = selectedCardNode.dataset.wishId;
        const winnerWish = wishes.find(w => w.id == chosenWishId);
        nextStageWishes.push(winnerWish);

        if (currentStage === STAGES.SEEDING) { // Sadece ilk turda oy say
            voteCounts[chosenWishId] = (voteCounts[chosenWishId] || 0) + 1;
        }
        
        const confetti = selectedCardNode.querySelector('.confetti-burst');
        if (confetti) {
            confetti.classList.remove('hidden');
            setTimeout(() => confetti.classList.add('hidden'), 700);
        }
        gameScreenCards.forEach(otherCard => {
            if (otherCard !== selectedCardNode) otherCard.classList.add('not-selected');
        });

        setTimeout(() => {
            currentMatchInStage++;
            let totalMatchesInThisStage = 0;
            if (currentStage === STAGES.SEEDING) totalMatchesInThisStage = 16;
            else totalMatchesInThisStage = wishesForCurrentStage.length / 2;

            if (currentMatchInStage >= totalMatchesInThisStage) {
                advanceToNextStage();
            } else {
                updateProgressBar();
                loadNextMatchUI();
            }
        }, 1000);
    }

    function advanceToNextStage() {
        currentMatchInStage = 0;
        wishesForCurrentStage = [...nextStageWishes];
        shuffleArray(wishesForCurrentStage); // Bir sonraki tur için kazananları karıştır
        nextStageWishes = [];

        switch (currentStage) {
            case STAGES.SEEDING:      currentStage = STAGES.ROUND_OF_16; break;
            case STAGES.ROUND_OF_16:  currentStage = STAGES.QUARTERFINALS; break;
            case STAGES.QUARTERFINALS:currentStage = STAGES.SEMIFINALS; break;
            case STAGES.SEMIFINALS:   currentStage = STAGES.TRANSITION_TO_FINAL; break; // Yarı final sonrası geçiş ekranı
            case STAGES.TRANSITION_TO_FINAL: currentStage = STAGES.FINAL; break;
            case STAGES.FINAL:        
                champion = wishesForCurrentStage[0]; // Finalin kazananı şampiyon
                currentStage = STAGES.RESULTS; 
                break;
        }
        
        if (currentStage === STAGES.TRANSITION_TO_FINAL) {
            displayTournamentTransitionScreen();
        } else if (currentStage === STAGES.RESULTS) {
            displayResultsScreen();
        } else if (wishesForCurrentStage.length >= 2) { // En az 2 yarışmacı varsa devam et
            updateProgressBar();
            loadNextMatchUI();
            showScreen('game');
        } else if (wishesForCurrentStage.length === 1 && currentStage !== STAGES.FINAL) { // Eğer bir şekilde tek kişi kaldıysa ve final değilse, o şampiyon olur.
             champion = wishesForCurrentStage[0];
             currentStage = STAGES.RESULTS;
             displayResultsScreen();
        }
         else {
            console.error("Bir sonraki aşamaya geçilemiyor, yeterli yarışmacı yok veya aşama bilinmiyor.", currentStage, wishesForCurrentStage);
            // Hata durumunda sonuçları göster veya başa dön.
            displayResultsScreen(); // Mevcut verilerle sonuçları göstermeyi dene.
        }
    }

    function displayTournamentTransitionScreen() {
        // wishesForCurrentStage burada 2 finalisti içermeli
        tournamentTransitionTitle.textContent = "Finalistler Belli Oldu!";
        tournamentTransitionSubtitle.textContent = "Şimdi şampiyonu belirleme zamanı!";
        tournamentTransitionCardContainer.innerHTML = ''; // Temizle

        const finalists = wishesForCurrentStage.slice(0, 2); // İlk iki finalist
        
        // Finalist kartlarını oluştur
        finalists.forEach((finalist, index) => {
            const cardDiv = document.createElement('div');
            cardDiv.className = "finalist-card bg-white rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl @container";
            if (index === 0) cardDiv.classList.add('tournament-final-card-glow'); // İlkini daha çok vurgula

            cardDiv.innerHTML = `
                <div class="card-image w-full bg-center bg-no-repeat aspect-[16/10] bg-cover" style='background-image: url("https://picsum.photos/seed/${finalist.imageSeed}/600/400");'></div>
                <div class="p-4 @xl:px-5">
                    <h3 class="card-title text-slate-800 text-lg font-bold">${finalist.title}</h3>
                    <p class="card-description text-slate-500 text-sm font-normal mt-1">${finalist.description.substring(0,80)}...</p>
                    <p class="card-votes text-slate-400 text-xs font-medium mt-2">${voteCounts[finalist.id] || 'Çok sayıda'} başlangıç oyu</p>
                </div>`;
            tournamentTransitionCardContainer.appendChild(cardDiv);
        });

        // Üçüncü kart için en popülerlerden birini (finalistler hariç) ekleyebiliriz
        const initialVotesSorted = Object.entries(voteCounts).sort(([,a],[,b]) => b-a);
        let thirdPopularWish = null;
        for (const [id,] of initialVotesSorted) {
            if (!finalists.find(f => f.id == id)) {
                thirdPopularWish = wishes.find(w => w.id == id);
                break;
            }
        }
        if (thirdPopularWish && tournamentTransitionCardContainer.children.length < 3) {
             const cardDiv = document.createElement('div');
            cardDiv.className = "finalist-card bg-white rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl @container";
            cardDiv.innerHTML = `
                <div class="card-image w-full bg-center bg-no-repeat aspect-[16/10] bg-cover" style='background-image: url("https://picsum.photos/seed/${thirdPopularWish.imageSeed}/600/400");'></div>
                <div class="p-4 @xl:px-5">
                    <h3 class="card-title text-slate-800 text-lg font-bold">${thirdPopularWish.title}</h3>
                    <p class="card-description text-slate-500 text-sm font-normal mt-1">${thirdPopularWish.description.substring(0,80)}...</p>
                    <p class="card-votes text-slate-400 text-xs font-medium mt-2">${voteCounts[thirdPopularWish.id] || 0} başlangıç oyu</p>
                </div>`;
            tournamentTransitionCardContainer.appendChild(cardDiv);
        }
         // Eğer hala 3 kart yoksa ve finalist sayısı 1 ise (hata durumu ama...)
        while(tournamentTransitionCardContainer.children.length < Math.min(3, wishes.length) && tournamentTransitionCardContainer.children.length < finalists.length +1) {
            const randomWish = wishes[Math.floor(Math.random() * wishes.length)];
            if (!finalists.find(f => f.id == randomWish.id) && randomWish.id !== (thirdPopularWish ? thirdPopularWish.id : -1) ) {
                 const cardDiv = document.createElement('div');
                cardDiv.className = "finalist-card bg-white rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl @container";
                cardDiv.innerHTML = `...`; // Yukarıdaki gibi doldur
                tournamentTransitionCardContainer.appendChild(cardDiv);
                if(tournamentTransitionCardContainer.children.length >=3) break;
            }
        }


        showScreen('tournamentTransition');
    }
    
    function displayResultsScreen() {
        if (!champion) { // Eğer şampiyon belirlenmemişse (örneğin, direkt bu ekrana gelindiyse)
            // En çok oy alan veya rastgele birini şampiyon yap
            const sortedByVotes = Object.keys(voteCounts).sort((a,b) => voteCounts[b] - voteCounts[a]);
            champion = wishes.find(w => w.id == sortedByVotes[0]) || wishes[0];
            console.warn("Şampiyon bulunamadı, en çok oy alan veya rastgele biri atandı:", champion.title);
        }

        championTitle.textContent = champion.title;
        championImage.src = `https://picsum.photos/seed/${champion.imageSeed}/600/400`;
        championImage.alt = champion.title;
        championInfo.textContent = `Bu dilek turnuvanın şampiyonu oldu!`;
        
        resultsCardContainer.innerHTML = ''; // Temizle
        resultsCardContainer.appendChild(championCardDisplay); // Şampiyon kartını başa ekle

        // Diğer popüler dilekleri listele (şampiyon hariç)
        const otherPopularWishes = Object.entries(voteCounts)
            .map(([id, count]) => ({ ...wishes.find(w => w.id == id), voteCount: count }))
            .filter(w => w.id !== champion.id)
            .sort((a, b) => b.voteCount - a.voteCount)
            .slice(0, 4); // En fazla 4 tane daha göster

        otherPopularWishes.forEach(wish => {
            if (!wish.title) return; // Hatalı veri varsa atla
            const cardHTML = `
                <div class="bg-white shadow-lg rounded-2xl overflow-hidden">
                    <div class="relative">
                        <img alt="${wish.title}" class="w-full h-40 object-cover" src="https://picsum.photos/seed/${wish.imageSeed}/600/300"/>
                        <div class="absolute inset-0 bg-hero-gradient"></div>
                        <div class="absolute bottom-0 left-0 p-4">
                            <p class="text-white text-xl font-bold leading-tight">${wish.title}</p>
                            <div class="flex items-center mt-1.5">
                                <span class="material-icons text-red-400 mr-1" style="font-size: 18px;">favorite_border</span>
                                <p class="text-white text-sm font-medium">${wish.voteCount || 0} başlangıç oyu</p>
                            </div>
                        </div>
                    </div>
                </div>`;
            resultsCardContainer.insertAdjacentHTML('beforeend', cardHTML);
        });
        showScreen('results');
    }
    
    function displayFinishScreen() {
        if (!champion) champion = wishes[0]; // Güvenlik önlemi
        winningWishTextFinishElement.textContent = `Şampiyon dilek: ${champion.title}! Bu harika geleceği arkadaşlarınla paylaş!`;
        
        moreDreamsContainer.innerHTML = '';
        const shuffledWishes = [...wishes].filter(w => w.id !== champion.id);
        shuffleArray(shuffledWishes);
        for(let i=0; i < Math.min(3, shuffledWishes.length); i++) {
            const dream = shuffledWishes[i];
            const dreamCardHTML = `
                <div class="flex flex-col gap-3 rounded-xl min-w-[280px] bg-white shadow-lg p-4">
                    <div class="w-full bg-center bg-no-repeat aspect-video bg-cover rounded-lg" style='background-image: url("https://picsum.photos/seed/${dream.imageSeed}/400/225");'></div>
                    <p class="text-[#0d131b] text-base font-medium leading-normal flex-grow">${dream.title}</p>
                    <button class="mt-auto flex items-center justify-center w-full h-10 rounded-lg bg-rose-100 text-rose-600 hover:bg-rose-200 transition-colors duration-200 text-sm font-semibold">
                        <span class="material-icons text-sm mr-1">favorite_border</span> Bunu dile!
                    </button>
                </div>`;
            moreDreamsContainer.insertAdjacentHTML('beforeend', dreamCardHTML);
        }
        showScreen('finish');
    }

    // ---------- Olay Dinleyicileri ----------
    startGameButton.addEventListener('click', () => {
        resetGame();
        showScreen('game');
    });

    gameScreenCards.forEach(card => {
        card.addEventListener('click', () => handleCardSelection(card));
    });
    
    closeTournamentTransitionButton.addEventListener('click', () => { resetGame(); showScreen('start'); });
    proceedToFinalMatchButton.addEventListener('click', () => {
        loadingScreenTournamentTransition.classList.remove('hidden');
        setTimeout(() => {
            loadingScreenTournamentTransition.classList.add('hidden');
            // currentStage zaten TRANSITION_TO_FINAL olmalı, advanceToNextStage Final'e geçirecek
            advanceToNextStage(); 
        }, 1500);
    });

    closeResultsButton.addEventListener('click', () => { resetGame(); showScreen('start'); });
    resultsPlayAgainButton.addEventListener('click', (e) => { e.preventDefault(); resetGame(); showScreen('game'); });
    resultsToFinishButton.addEventListener('click', (e) => { e.preventDefault(); displayFinishScreen(); });

    closeFinishButton.addEventListener('click', () => { resetGame(); showScreen('start'); });
    finishPlayAgainButton.addEventListener('click', () => { resetGame(); showScreen('game'); });
    finishHomeButton.addEventListener('click', (e) => { e.preventDefault(); resetGame(); showScreen('start'); });
    finishToResultsButton.addEventListener('click', (e) => { e.preventDefault(); displayResultsScreen(); });
    
    shareChampionButton.addEventListener('click', () => {
        if(navigator.share && champion) {
            navigator.share({
                title: 'Keşke Gerçek Olsa - Şampiyon Dilek!',
                text: `Benim şampiyon dileğim: ${champion.title}! Sen de oyna ve kendi geleceğini seç! #KeşkeGerçekOlsa`,
            }).catch(error => console.log('Paylaşım hatası:', error));
        } else {
            alert(`Şampiyon dilek: ${champion ? champion.title : 'Harika bir gelecek'}!`);
        }
    });

    // ---------- Oyun Başlangıcı ----------
    document.addEventListener('DOMContentLoaded', () => {
        showScreen('start');
    });

</script>
</body>
</html>
